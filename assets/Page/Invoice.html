<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invoice Document</title>
    <link rel="stylesheet" href="../Style/main.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #1e1e1e !important;
        color: white;
      }
      h2 {
        font-weight: 800;
      }
      .invoice {
        padding: 20px;
      }
      .invoice-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      .invoice-header-left {
        flex: 1;
      }
      .invoice-header-right {
        flex: 1;
        text-align: right;
      }
      .invoice-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 5%;
      }
      .invoice-table th,
      .invoice-table td {
        border: 1px solid #000;
        padding: 10px;
        text-align: center;
      }
      .invoice-table th {
        background-color: #1a1919;
        color: #fff;
        font-weight: bold;
      }
      .invoice-total {
        float: right;
      }
      #video {
        display: none;
        width: 100%;
        max-width: 400px;
        margin: 20px 0;
      }
      #result {
        margin-top: 10px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="invoice">
      <div class="invoice-header">
        <div class="invoice-header-left">
          <!-- <img src="../img/logo.PNG" alt="Company Logo" width="150" /> -->

          <h1>Company Name</h1>
          <p>123 Main Street, Cityville, Country</p>
          <p>Email: info@company.com</p>
          <p>Phone: +1 234-567-8901</p>
        </div>

        <div class="invoice-header-right">
          <h2 style="color: white">Invoice</h2>
          <p>Invoice Number: #123456</p>
          <p>Date: 2023-12-03</p>
        </div>
      </div>

      <!--  -->

      <div class="col-auto d-flex align-items-center my-2 my-sm-0">
        <div class="messageBox">
          <div class="fileUploadWrapper">
            <label for="upload">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 337 337"
              >
                <circle
                  stroke-width="20"
                  stroke="#6c6c6c"
                  fill="none"
                  r="158.5"
                  cy="168.5"
                  cx="168.5"
                ></circle>
                <path
                  stroke-linecap="round"
                  stroke-width="25"
                  stroke="#6c6c6c"
                  d="M167.759 79V259"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-width="25"
                  stroke="#6c6c6c"
                  d="M79 167.138H259"
                ></path>
              </svg>
              <span class="tooltip">Add an image</span>
            </label>
            <input
              type="file"
              id="upload"
              name="upload"
              accept="image/*"
              onchange="handleFileSelect(event)"
            />
          </div>

          <!-- upload -->

          <input
            required=""
            type="text"
            id="discount"
            placeholder="Enter Discount (%)"
          />

          <button id="sendButton" onclick="applyDiscount()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="#6c6c6c"
              class="bi bi-search"
              viewBox="0 0 16 16"
            >
              <path
                d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"
              ></path>
            </svg>
          </button>

          <button id="sendButton" onclick="processImage()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 664 663"
            >
              <path
                fill="none"
                d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888"
              ></path>
              <path
                stroke-linejoin="round"
                stroke-linecap="round"
                stroke-width="33.67"
                stroke="#6c6c6c"
                d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888"
              ></path>
            </svg>
          </button>
        </div>

        <style>
          /* From Uiverse.io by vinodjangid07 */
          .messageBox {
            width: fit-content;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #2d2d2d;
            padding: 0 15px;
            border-radius: 5px;
            border: 1px solid rgb(63, 63, 63);
          }
          .messageBox:focus-within {
            border: 1px solid rgb(110, 110, 110);
          }
          .fileUploadWrapper {
            width: fit-content;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: Arial, Helvetica, sans-serif;
          }

          #upload {
            display: none;
          }
          .fileUploadWrapper label {
            cursor: pointer;
            width: fit-content;
            height: fit-content;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
          }
          .fileUploadWrapper label svg {
            height: 18px;
          }
          .fileUploadWrapper label svg path {
            transition: all 0.3s;
          }
          .fileUploadWrapper label svg circle {
            transition: all 0.3s;
          }
          .fileUploadWrapper label:hover svg path {
            stroke: #fff;
          }
          .fileUploadWrapper label:hover svg circle {
            stroke: #fff;
            fill: #3c3c3c;
          }
          .fileUploadWrapper label:hover .tooltip {
            display: block;
            opacity: 1;
          }
          .tooltip {
            position: absolute;
            top: -40px;
            display: none;
            opacity: 0;
            color: white;
            font-size: 10px;
            text-wrap: nowrap;
            background-color: #000;
            padding: 6px 10px;
            border: 1px solid #3c3c3c;
            border-radius: 5px;
            box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.596);
            transition: all 0.3s;
          }
          input#discount {
            width: 200px;
            height: 100%;
            background-color: transparent;
            outline: none;
            border: none;
            padding-left: 10px;
            color: white;
          }
          input#discount:focus ~ #sendButton svg path,
          input#discount:valid ~ #sendButton svg path {
            fill: #3c3c3c;
            stroke: white;
          }

          #sendButton {
            width: fit-content;
            height: 100%;
            background-color: transparent;
            outline: none;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
          }
          #sendButton svg {
            height: 18px;
            transition: all 0.3s;
          }
          #sendButton svg path {
            transition: all 0.3s;
          }
          #sendButton:hover svg path {
            fill: #3c3c3c;
            stroke: white;
          }
        </style>

        <a href="#0" class="btn btn-lg btn-warning" onclick="startCamera()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-camera"
            viewBox="0 0 16 16"
          >
            <path
              d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4z"
            ></path>
            <path
              d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7M3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"
            ></path>
          </svg>
        </a>
      </div>
      <!--  -->
      <br />

      <div>
        <video id="video"></video>
        <div id="result"></div>

        <table id="barcode-list" class="invoice-table">
          <thead>
            <tr>
              <th>Barcode</th>
              <th>Price</th>
              <th>Size</th>
              <th>Color</th>
              <th>Quantity</th>
              <th>Price After Discount</th>
              <th>Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dynamically populated rows will go here -->
          </tbody>
        </table>
      </div>

      <div class="invoice-total">
        <p>Subtotal: $<span id="subtotal">0.00</span></p>
        <p>Total: $<span id="total">0.00</span></p>
      </div>

      <div class="invoice-footer">
        <div class="mt-3">
          <p>Thank you for your support</p>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <script>
      let selectedFile;
      let codeReader = new ZXing.BrowserBarcodeReader();

      function handleFileSelect(event) {
        selectedFile = event.target.files[0];
        document.getElementById("result").innerText = ""; // Clear previous result
      }

      async function processImage() {
        if (selectedFile) {
          const resultElement = document.getElementById("result");
          resultElement.innerText = "Processing...";

          const imgElement = document.createElement("img");
          imgElement.src = URL.createObjectURL(selectedFile);

          imgElement.onload = async () => {
            try {
              const result = await codeReader.decodeFromImageElement(
                imgElement
              );
              resultElement.innerText = result.text; // Display the result
              addBarcodeToList(result.text, "0.00", "N/A", "N/A", "0");
              playSound(); // Play sound on success
              updateTotals(); // Update totals after adding barcode
            } catch (error) {
              resultElement.innerText = "Failed to read barcode.";
              console.error("Image scan error:", error);
            }
          };
        } else {
          document.getElementById("result").innerText =
            "Please select an image first.";
        }
      }

      async function startCamera() {
        const videoElement = document.getElementById("video");
        const resultElement = document.getElementById("result");
        videoElement.style.display = "block";

        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment" },
          });
          videoElement.srcObject = stream;
          videoElement.play();

          codeReader.decodeFromVideoDevice(
            null,
            videoElement,
            (result, err) => {
              if (result) {
                resultElement.innerText = result.text;
                addBarcodeToList(result.text, "0.00", "N/A", "N/A", "0");
                playSound();
                codeReader.reset();
                stream.getTracks().forEach((track) => track.stop());
                updateTotals(); // Update totals after scanning
              }
              if (err && !(err instanceof ZXing.NotFoundException)) {
                console.error(err);
              }
            }
          );
        } catch (error) {
          console.error("Error accessing camera:", error);
          resultElement.innerText = "Error accessing camera.";
        }
      }

      function playSound() {
        const sound = new Audio("path/to/success-sound.mp3"); // Replace with your sound file
        sound.play();
      }

      function addBarcodeToList(barcode, price, size, color, quantity) {
        const barcodeList = document
          .getElementById("barcode-list")
          .getElementsByTagName("tbody")[0];
        const row = document.createElement("tr");
        row.innerHTML = `
                <td>${barcode}</td>
                <td contenteditable="true">${price}</td>
                <td contenteditable="true">${size}</td>
                <td contenteditable="true">${color}</td>
                <td contenteditable="true">${quantity}</td>
                <td class="price-after-discount">0.00</td>
                <td class="total">0.00</td> <!-- New Total Cell -->
                <td>
                    <button onclick="removeBarcode(this)" class="exit">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1-.708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                        </svg>
                    </button>
                </td>
            `;
        barcodeList.appendChild(row);
        updateTotals(); // Update totals when a new barcode is added
      }

      function removeBarcode(button) {
        const row = button.parentElement.parentElement;
        row.parentElement.removeChild(row);
        updateTotals(); // Update totals when a barcode is removed
      }

      function applyDiscount() {
        const discountValue =
          parseFloat(document.getElementById("discount").value) || 0;

        const barcodeList = document.getElementById("barcode-list");
        const rows = barcodeList.getElementsByTagName("tbody")[0].rows;

        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          const price = parseFloat(row.cells[1].innerText) || 0;
          const discountAmount = (price * discountValue) / 100;
          const priceAfterDiscount = price - discountAmount;

          row.cells[5].innerText = priceAfterDiscount.toFixed(2); // Update price after discount
          const quantity = parseFloat(row.cells[4].innerText) || 0;
          const total = priceAfterDiscount * quantity;
          row.cells[6].innerText = total.toFixed(2); // Update total
        }

        updateTotals(); // Update totals after applying the discount
      }

      function updateTotals() {
        const barcodeList = document.getElementById("barcode-list");
        const rows = barcodeList.getElementsByTagName("tbody")[0].rows;

        let subtotal = 0;

        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          const total = parseFloat(row.cells[6].innerText) || 0;
          subtotal += total;
        }

        document.getElementById("subtotal").innerText = subtotal.toFixed(2);
        document.getElementById("total").innerText = subtotal.toFixed(2);
      }
    </script>
  </body>
</html>
